<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>급식 공지</title>
    <style>
        @font-face {
            font-family: 'SandolB';
            src: url('./ttf/AppleSDGothicNeoM.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'SandolL';
            /* 내가 붙일 이름 */
            src: url('./ttf/AppleSDGothicNeoL.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'SandolL', sans-serif;
        }


        /* ------------------------------
       화면 비율 고려한 vw 기반 타이포 & 여백
       - 최대/최소 가독성을 위해 clamp() 사용
       - 오른쪽의 "○학생 먼저입니다" 표시는 제외
       ------------------------------ */

        :root {
            /* 기본 폭 비율: 모바일 한 면 기준 92vw 카드 */
            --page-w: min(92vw, 520px);
            /* 너무 커지는 것 방지 */

            /* 타이포 크기 (vw 중심) */
            --title-fs: clamp(22px, 8vw, 42px);
            --label-fs: clamp(14px, 4.8vw, 22px);
            --menu-fs: clamp(14px, 4.2vw, 22px);

            /* 여백 (vw 중심) */
            --outer-pad-y: clamp(16px, 5vw, 32px);
            --outer-pad-x: clamp(18px, 6vw, 36px);
            --section-gap: clamp(16px, 4.8vw, 28px);
            --line-gap: clamp(6px, 2.2vw, 12px);
            --label-w: clamp(48px, 14vw, 76px);
            /* 왼쪽 라벨 고정폭 */
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: #2b2b2b;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: clamp(12px, 3.2vw, 24px) 0;
        }

        .card {
            width: var(--page-w);
            padding: var(--outer-pad-y) var(--outer-pad-x);
            background: #fff;
        }

        /* 헤더 (가운데 정렬 타이틀만) */
        .header {
            text-align: center;
            margin-bottom: clamp(12px, 4vw, 22px);
        }

        .title {
            font-size: var(--title-fs);
            /* font-weight: 700; */
            /* letter-spacing: 0.02em; */
            font-family: 'SandolB', sans-serif;
        }

        /* 본문: 왼쪽 라벨, 오른쪽 메뉴 */
        .section {
            display: flex;
            align-items: flex-start;
            gap: clamp(12px, 3.6vw, 20px);
            margin-bottom: var(--section-gap);
        }

        .label {
            flex: 0 0 var(--label-w);
            font-size: var(--label-fs);
            /* font-weight: 600; */
            padding-top: 0.03em;
        }

        input {
            font-family: 'SandolL', sans-serif;
            font-size: var(--label-fs);
        }

        .menu {
            flex: 1;
            font-size: var(--menu-fs);
            line-height: 1.5;
        }

        .menu p {
            margin: 0 0 2px 0;
        }

        /* 마지막 섹션은 여백 제거 */
        .section:last-of-type {
            margin-bottom: 0;
        }

        /* 세로로 긴 화면에서 상하 여백을 조금 늘림 */
        @media (min-aspect-ratio: 9/16) {
            :root {
                --outer-pad-y: clamp(20px, 6vw, 40px);
            }
        }
    </style>
</head>

<body>
    <main class="card" role="main">
        <header class="header">
            <h1 class="title" id="title"></h1>
            <input style="border:0px">
        </header>

        <section class="section">
            <div class="label">중식</div>
            <div id="menu" class="menu" aria-label="중식 메뉴">
            </div>
        </section>

        <section class="section">
            <div class="label">석식</div>
            <div class="menu" id="menuD" aria-label="석식 메뉴">
            </div>
        </section>
    </main>

    <script>
        function lunch() {
            var today = new Date();
            var dateInfo = new Date(today.setDate(today.getDate() + 1));
            var year = dateInfo.getFullYear();
            var month = dateInfo.getMonth() + 1;
            var date = dateInfo.getDate();
            var time = dateInfo.getHours();
            var todaydate =
                year +
                '' +
                ('00' + month.toString()).slice(-2) +
                '' +
                ('00' + date.toString()).slice(-2);

            const url =
                'https://open.neis.go.kr/hub/mealServiceDietInfo?ATPT_OFCDC_SC_CODE=' +
                'S10' + // 학교 코드
                '&SD_SCHUL_CODE=' +
                '9010079' + // 행정 표준 코드
                '&MLSV_YMD=' +
                todaydate +
                '&TYPE=JSON' +
                '&MMEAL_SC_CODE=2' +
                '&key=0329ec2eb15f4888b665ab2b92887d4a'; // 키값

            var today = new Date();
            var weekday = new Array(7);
            weekday[0] = '일요일';
            weekday[1] = '월요일';
            weekday[2] = '화요일';
            weekday[3] = '수요일';
            weekday[4] = '목요일';
            weekday[5] = '금요일';
            weekday[6] = '토요일';
            var day = weekday[today.getDay()];

            const request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.onload = function () {


                const data = JSON.parse(request.responseText);
                // mealServiceDietInfo 안에서 row가 있는 객체 찾기
                const rowObj = data.mealServiceDietInfo.find(item => item.row);

                // row가 있으면 메뉴 이름만 추출
                let menuNames = [];
                if (rowObj && rowObj.row) {
                    menuNames = rowObj.row.map(item => item.DDISH_NM);
                }

                // 괄호 안 알레르기 정보 제거 + <br/>을 줄바꿈으로 변환
                let menuName = JSON.stringify(menuNames)
                .replace(/\([^)]*\)/g, "")   // 괄호 안 제거
                // .replace(/<br\/?>/g, "\n") // <br> 태그 삭제
                .replace(/[\[\]"]/g, '');

                document.getElementById('title').innerHTML = `${month}.${date} 급식`;
                document.getElementById('menu').innerHTML = menuName;
            };
            request.send();
        }

        lunch();

        function dinner() {
            var today = new Date();
            var dateInfo = new Date(today.setDate(today.getDate() + 1));
            var year = dateInfo.getFullYear();
            var month = dateInfo.getMonth() + 1;
            var date = dateInfo.getDate();
            var time = dateInfo.getHours();
            var todaydate =
                year +
                '' +
                ('00' + month.toString()).slice(-2) +
                '' +
                ('00' + date.toString()).slice(-2);
            if (time > '13') {
                var tomorrow = new Date(dateInfo.setDate(dateInfo.getDate() + 1));
                var year = tomorrow.getFullYear();
                var month = tomorrow.getMonth() + 1;
                var date = tomorrow.getDate();
                var time = tomorrow.getHours();
                var todaydate =
                    year +
                    '' +
                    ('00' + month.toString()).slice(-2) +
                    '' +
                    ('00' + date.toString()).slice(-2);
            }

            const url =
                'https://open.neis.go.kr/hub/mealServiceDietInfo?ATPT_OFCDC_SC_CODE=' +
                'S10' + // 학교 코드
                '&SD_SCHUL_CODE=' +
                '9010079' + // 행정 표준 코드
                '&MLSV_YMD=' +
                todaydate +
                '&TYPE=JSON' +
                '&MMEAL_SC_CODE=3' +
                '&key=0329ec2eb15f4888b665ab2b92887d4a'; // 키값

                console.log(url);
            var today = new Date();
            var weekday = new Array(7);
            weekday[0] = '일요일';
            weekday[1] = '월요일';
            weekday[2] = '화요일';
            weekday[3] = '수요일';
            weekday[4] = '목요일';
            weekday[5] = '금요일';
            weekday[6] = '토요일';
            var day = weekday[today.getDay()];

            const request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.onload = function () {


                const data = JSON.parse(request.responseText);
                // mealServiceDietInfo 안에서 row가 있는 객체 찾기
                const rowObj = data.mealServiceDietInfo.find(item => item.row);

                // row가 있으면 메뉴 이름만 추출
                let menuNames = [];
                if (rowObj && rowObj.row) {
                    menuNames = rowObj.row.map(item => item.DDISH_NM);
                }

                // 괄호 안 알레르기 정보 제거 + <br/>을 줄바꿈으로 변환
                let menuName = JSON.stringify(menuNames)
                .replace(/\([^)]*\)/g, "")   // 괄호 안 제거
                // .replace(/<br\/?>/g, "\n") // <br> 태그 삭제
                .replace(/[\[\]"]/g, '');

                document.getElementById('menuD').innerHTML = menuName;
            };
            request.send();
        }

        dinner();
    </script>
</body>

</html>